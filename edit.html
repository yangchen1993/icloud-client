<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="x-ua-compatible" content="IE=Edge">
    <title>编辑区</title>
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.css"/>
    <link rel="stylesheet" href="css/style.css"/>
    <link rel="stylesheet" href="css/buttons.css"/>
    <link rel="stylesheet" href="css/icon/iconfont.css"/>
    <link rel="stylesheet" href="css/phone_cms.css"/>
    <link rel="stylesheet" href="js/cms/jquery-minicolors/jquery.minicolors.css"/>
    <link rel="stylesheet" href="bower_components/cropper/dist/cropper.min.css"/>
    <script type="text/javascript" src="http://api.map.baidu.com/api?type=quick&ak=n1WHijd9nUZX0K6pMMGc1A6N&v=1.0"></script>
    <style>
        html,body{
            margin: 0;
            height:100%;
            background: url("images/cms_bg_grid.jpg") repeat;
        }
        .container-fluid{
            width: 100%;
            min-height: 100%;
            min-width: 1200px;
        }
        .header{
            height:55px;
            line-height:55px;
            background:#11cd6e none repeat scroll 0% 0%;
        }
        .logo{
            width:120px;
            height:50px;
            color:#fff;
        }
        .component>div{
            float:left;
            width:33.3333333%;
            padding:25px 0 0 0;
            text-align: center;
        }
        .font2x{
            font-size: 30px;
        }
        .left{
            padding-top: 10px;
            height:auto;
            background: #ea8010;
        }
        .right{
            padding-top: 10px;
            height:auto;
        }
        .page a{
            color:#666;
        }
        .pages>div:hover{
            background:grey;
        }
        .component>div{
            cursor:pointer;
        }
        .fr{
            float:right;
        }
        #myword{
            word-wrap: break-word;
        }
        .photoshow{
            margin-top:10px;
        }
        .photoshow img{
            width: 100%;
        }
        .deledit{
            position: absolute;
            top:0;
            right: 20px;
        }
        .deledit span{
            display: inline-block;
            width:40px;
            height:20px;
            color:#fff;
            border-radius: 10px;
            text-align: center;
        }

        .deledit span:first-child{
            background:aqua;
        }
        .deledit span:last-child{
             background:red;
        }
        .avatar-wrapper {
            height: 364px;
            width: 100%;
            margin-top: 15px;
            box-shadow: inset 0 0 5px rgba(0,0,0,.25);
            background-color: #fcfcfc;
            overflow: hidden;
        }
        .dodo2>div{
            width: 100% !important;
            height:300px !important;
        }
        .avatar-view img{
            width: 100px;
            height:100px;
        }
        .mt20{
            margin-top:20px;
        }
        .deledit{
            display: none;
        }
        #drag li:hover .deledit{
            display: block;
        }
        .map{
            width: 100%;
            height:200px;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row header">
            <div class="col-xs-3">
                <div class="logo">
                    店铺编辑中心
                </div>
            </div>
            <div class="col-xs-4 col-xs-offset-5 text-right">
                <button class="button button-primary button-small"><i class="icon iconfont">&#xe608;</i>返回店铺中心</button>
                <button class="button button-primary button-small"><i class="icon iconfont">&#xe63a;</i>预览页面</button>
            </div>
        </div>
        <div class="row main">
            <div class="col-xs-3 left">
                <div class="panel panel-success">
                    <div class="panel-heading text-center">
                        我的页面
                    </div>
                    <div class="panel-body pages">
                        <div><i class="icon iconfont">&#xe61e;</i><a href="">页面1</a><span class="fr"><i class="icon iconfont">&#xe6be;</i><i class="icon iconfont">&#xe636;</i></span></div>
                        <div><i class="icon iconfont">&#xe61e;</i><a href="">页面2</a><span class="fr"><i class="icon iconfont">&#xe6be;</i><i class="icon iconfont">&#xe636;</i></span></div>
                        <div><i class="icon iconfont">&#xe61e;</i><a href="">页面3</a><span class="fr"><i class="icon iconfont">&#xe6be;</i><i class="icon iconfont">&#xe636;</i></span></div>
                        <div><i class="icon iconfont">&#xe61e;</i><a href="">页面4</a><span class="fr"><i class="icon iconfont">&#xe6be;</i><i class="icon iconfont">&#xe636;</i></span></div>
                    </div>
                </div>

                <div class="panel panel-danger page">
                    <div class="panel-heading text-center">组件中心</div>
                    <div class="panel-body component">
                        <div class=""   id="dj-text"  >
                            <i class="icon iconfont font2x">&#xe789;</i>
                            <div>文字</div>
                        </div>

                        <div class="" id="dj-img">
                            <i class="icon iconfont font2x">&#xe6d1;</i>
                            <div>图片</div>
                        </div>

                        <div class="">
                            <i class="icon iconfont font2x">&#xf002c;</i>
                            <div>幻灯片</div>
                        </div>

                        <div class="">
                            <i class="icon iconfont font2x">&#xe721;</i>
                            <div>菜单</div>
                        </div>

                        <div class="">
                            <i class="icon iconfont font2x">&#xe836;</i>
                            <div>导航</div>
                        </div>

                        <div class="">
                            <i class="icon iconfont font2x">&#xf0007;</i>
                            <div>电话</div>
                        </div>

                        <div class="">
                            <i class="icon iconfont font2x">&#xe62c;</i>
                            <div>广告</div>
                        </div>

                        <div class="">
                            <i class="icon iconfont font2x">&#xe64d;</i>
                            <div>活动</div>
                        </div>

                        <div class="">
                            <i class="icon iconfont font2x">&#xe6ec;</i>
                            <div>应用</div>
                        </div>

                        <div class="">
                            <i class="icon iconfont font2x">&#xe673;</i>
                            <div>地址</div>
                        </div>

                        <div class=""  id="dj-map" >
                            <i class="icon iconfont font2x">&#xe64c;</i>
                            <div>地图</div>
                        </div>

                        <div class="">
                            <i class="icon iconfont font2x">&#xe684;</i>
                            <div>视频</div>
                        </div>

                        <!--新添组件-->
                        <div class="">
                        </div>

                        <div class="">
                        </div>

                        <div class="">
                        </div>

                        <div class="">
                        </div>

                    </div>
                </div>

                <p class="text-center">店家网络&copy;2013-2015</p>
            </div>
            <div class="col-xs-9 right">
                <div class="row">
                    <div class="col-xs-7">
                        <div class="phone">
                            <div class="phone-page">
                                <!--手机装饰-->
                                <div class="phone-ear">
                                    <span class="phone-camera"></span><span class="phone-sound"></span>
                                </div>
                                <!--以下的phone-warp是直接添加到数据库的部分-->
                                <div class="phone-warp">
                                    <div class="phone-content">
                                        <ul id="drag">
                                        </ul>

                                        <div><a href="http://www.idianjia.com">店家</a>提供技术支持</div>
                                    </div>
                                </div>
                                <div class="phone-button">
                                    <div class="circle-button"></div>
                                </div>
                            </div>
                        </div>
                        <div class="row mt20">
                            <div class="col-xs-12 text-center">
                                <button class="button button-primary" id="savePage"><i class="icon iconfont">&#xe63a;</i>保存页面</button>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-5">
                        <!--<div class="panel panel-success">-->
                            <!--<div class="panel-heading">-->
                                <!--<span class="panel-title"><i class="fa fa-cog"></i>文字编辑</span>-->
                            <!--</div>-->
                            <!--<div class="panel-body">-->
                                <!--<form class="form-horizontal">-->
                                    <!--<p>-->
                                        <!--<span class="h4">标题</span><small>(建议标题不长于12个字)</small>-->
                                        <!--<span style="float:right"><input type="checkbox">是否显示</span>-->
                                        <!--<input id="title" type="text" class="form-control">-->
                                    <!--</p>-->
                                    <!--<div class="form-group">-->
                                        <!--<div class="col-xs-6">背景色:<input type="text" class="form-control color"></div>-->
                                        <!--<div class="col-xs-6">文字色:<input type="text" class="form-control color"></div>-->
                                    <!--</div>-->
                                    <!--<div class="">-->
                                        <!--内容:-->
                                        <!--<textarea style="resize:none;" class="form-control" name="" id="txtarea" cols="30" rows="10"></textarea>-->
                                        <!--<p>限输入3000字,你还可以输入<small style="color:red;">3000</small>字</p>-->
                                        <!--<button class="button button-primary">保存</button>-->
                                    <!--</div>-->
                                    <!--&lt;!&ndash;<div class="form-group">&ndash;&gt;-->
                                    <!--&lt;!&ndash;<label for="title" class="col-xs-2 control-label">标题</label>&ndash;&gt;-->
                                    <!--&lt;!&ndash;<div class="col-xs-10"><input type="text" class="form-control" id="title"></div>&ndash;&gt;-->
                                    <!--&lt;!&ndash;</div>&ndash;&gt;-->
                                    <!--&lt;!&ndash;<div class="form-group">&ndash;&gt;-->
                                    <!--&lt;!&ndash;<label for="title" class="col-xs-2 control-label">背景色</label>&ndash;&gt;-->
                                    <!--&lt;!&ndash;<div class="col-xs-4"><input type="text" class="form-control" id="title"></div>&ndash;&gt;-->
                                    <!--&lt;!&ndash;<label for="title" class="col-xs-2 control-label">文字色</label>&ndash;&gt;-->
                                    <!--&lt;!&ndash;<div class="col-xs-4"><input type="text" class="form-control" id="title"></div>&ndash;&gt;-->
                                    <!--&lt;!&ndash;</div>&ndash;&gt;-->
                                <!--</form>-->
                            <!--</div>-->
                        <!--</div>-->
                        <!--图片-->
                        <div class="panel panel-danger">
                            <div class="panel-heading">
                                <span class="panel-title"><i class="icon iconfont">&#xe672;</i>&nbsp;图片编辑</span>
                            </div>
                            <div class="panel-body">
                                <div><label class="button button-primary" for="upload">上传图片</label><input type="file" class="hidden" id="upload" accept="image/jpeg,image/gif,image/png"></div>
                                <div>
                                    <div class="photoshow" style="display: inline-block;border:solid 1px gray;width:100px;height:100px;line-height: 100px;">
                                        <img id="showImg" src="images/test2.jpg">
                                    </div>

                                    <div style="display: inline-block;width:250px;">图片要求:<small>图片大小限制为:2MB以内，建议宽度640px
                                        仅支持JPG、PNG格式，建议使用JPG格式</small>
                                    </div>
                                </div>
                                <div class="dod2">
                                    <img src="images/test2.jpg">
                                </div>
                                <div class="btn-group" style="margin-top: 10px;">
                                    <div class="col-xs-12">链接方式:</div>
                                    <div class="col-xs-5">
                                        <select class="form-control" style="padding:6px 5px;">
                                            <option value="">内部网页</option>
                                            <option value="">外部链接</option>
                                        </select>
                                    </div>
                                    <div class="col-xs-7">
                                        <div class="input-group">
                                            <label class="input-group-addon">http://</label><input class="form-control" type="text"/>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="panel-footer text-center">
                                <button class="button button-caution save">保存</button>
                            </div>
                        </div>

                        <!--<div class="form-horizontal">-->
                            <!--<div class="panel panel-primary">-->
                                <!--<div class="panel-heading">-->
                                    <!--<span class="panel-title"><i class="icon iconfont">&#xe672;</i>&nbsp;菜单组件</span>-->
                                <!--</div>-->
                                <!--<div class="panel-body">-->
                                    <!--菜单设置:-->
                                    <!--<div class="input-group">-->
                                        <!--<div class="input-group-addon">背景色</div><input type="text" class="form-control color">-->
                                    <!--</div>-->
                                    <!--<div class="form-group" style="margin-top:15px;border-top:dashed 1px">-->
                                        <!--<div class="col-xs-5">-->
                                            <!--<div class="input-group">-->
                                                <!--<div class="input-group-addon">背景色</div><input type="text" class="form-control color">-->
                                            <!--</div>-->
                                        <!--</div>-->
                                        <!--<div class="col-xs-7">-->
                                            <!--<div class="input-group">-->
                                                <!--<div class="input-group-addon">文字色</div><input type="text" class="form-control color">-->
                                            <!--</div>-->
                                        <!--</div>-->
                                        <!--<div class="col-xs-12">-->
                                            <!--<div class="row">-->
                                                <!--<div class="col-xs-5">-->
                                                    <!--<div class="input-group">-->
                                                        <!--<div class="input-group-addon">链接</div>-->
                                                        <!--<select class="form-control" style="width:130%;font-size: 12px;padding:6px 1px;">-->
                                                            <!--<option value="">站内链接</option>-->
                                                            <!--<option value="">站外链接</option>-->
                                                        <!--</select>-->
                                                    <!--</div>-->
                                                <!--</div>-->
                                                <!--<div class="col-xs-7">-->
                                                    <!--<div class="input-group">-->
                                                        <!--<div class="input-group-addon">http://</div><input class="form-control" type="text"/>-->
                                                    <!--</div>-->
                                                <!--</div>-->

                                            <!--</div>-->
                                        <!--</div>-->
                                        <!--<div></div>-->
                                    <!--</div>-->
                                <!--</div>-->
                            <!--</div>-->
                        <!--</div>-->
                    </div>
                </div>
            </div>

        </div>

    </div>
    <div class="hidden">
        <!-- 下面是轮播~ -->

        <div class="template">
            <div class="menus">
                <nav class="menu">
                    <ul>
                        <li><a href="javascript:;" class="active">首页</a></li>
                        <li><a href="javascript:;">新闻</a></li>
                        <li><a href="javascript:;">商城</a></li>
                        <li><a href="javascript:;">知识</a></li>
                        <li><a href="javascript:;">留言板</a></li>
                    </ul>
                </nav>
            </div>
            <div class="text">
                <h4 class="title" style="margin:0;">标题</h4>
                <div class="content">文字</div>
            </div>
            <div class="img">
                <div class="img"><img src="images/1.jpg"></div>
                <!--<div class="lunbo">-->
                <!--<ul>-->
                <!--<li><img src="images/1.jpg"></li>-->
                <!--<li><img src="images/2.jpg"></li>-->
                <!--<li><img src="images/3.jpg"></li>-->
                <!--</ul>-->
                <!--</div>-->
            </div>
            <div class="map">
            </div>
        </div>

    </div>
    <div id="modaltt">sss</div>
    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">图片裁剪</h4>
                </div>
                <div class="modal-body">
                        <div class="dodo2">
                            <img id="imgsss">
                        </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary">保存</button>
                </div>
            </div>
        </div>
    </div>
    <div class="showPage">

    </div>
    <script src="js/cms/jquery.min.js"></script>
    <script type="text/javascript" src="js/cms/jquery.min.js"></script>
    <script type="text/javascript" src="js/cms/jquery.dragsort-0.5.2.min.js"></script>
    <script type="text/javascript" src="js/cms/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/cms/jquery-minicolors/jquery.minicolors.min.js"></script>
    <script type="text/javascript" src="js/cms/crop/cropper.min.js"></script>
    <script src="js/cms/ckeditor/ckeditor.js"></script>
    <script type="text/javascript" src="js/cms/unslider.min.js"></script>
    <!--<script type="text/javascript" src="js/sample.js"></script>-->
    <script type="text/javascript" src="js/cms/crop_main.js"></script>
    <script type="text/javascript" src="js/cms/main.js"></script>
    <script type="text/javascript">
//        $.get('http://192.168.10.200/api/cms/get_cms/?key=ee60934d-2838-4892-b1d9-6a630b993f13&id=4').success(function(data){
//            $('.phone-content').html(data.div);
//        });
        $('#savePage').click(function(){
            var component=$('.item-list');
            var length=component.length;
            var items=[];
            for(var i=0;i<length;i++){
                items.push({'component_id':$(component[i]).attr("id"),'content_type':$(component[i]).attr("data-type"),'div':$(component[i]).parent().html()});
            }
            console.log(items);
//            $.post('http://192.168.10.200/api/cms/new_cms/?key=ee60934d-2838-4892-b1d9-6a630b993f13',{'items':items},{"dataType":"json"});
            $.ajax({
                url:"http://192.168.10.200/api/cms/new_cms/?key=ee60934d-2838-4892-b1d9-6a630b993f13",
                type:"POST",
                "dataType":"json",
                'contentType':'application/json;charset=utf-8',
                "data":JSON.stringify({"items":items}),
                success:function (data) {

                },
                error:function(data){

                }
            })
        });
        $('input[type="file"]').change(function(){
//            var reader = new FileReader();
//            reader.onprogress=function(){
//                console.log("onprogress");
//            }
            console.log($(this).val());
            $('#myModal').modal('show');
//            $('#imgsss').attr('src',url);
        });
        var user={
            userId:'b0d9abc8-d416-4b1d-b9d4-2bc82e48f774',
            address:'四川省成都市锦江区',
            telephone:18780283005
//            经度、纬度
        }

        var t=$('.dod2 > img').cropper();
        $('.save').click(function(){
            var URL='http://192.168.10.200/api/resources/new_img_resource/?key='+user.userId;
            var imgData=$('.dod2 > img').cropper('getCroppedCanvas', {
                width:640
            }).toDataURL();
            $.post(URL,{img:imgData}).success(function(data){
                console.log(data);
                var imgUrl=data.link;
                $('#drag').append('<li><a href="'+imgUrl+'"><img style="width:100%;" src="'+imgUrl+'"></a></li>');
                $('#showImg').attr('src',imgUrl);
            });

        });
//        组件id生成器
        function addId(){
            var date=(new Date()).getTime();
            var num=Math.random();
            var newId='d'+''+num.toString().replace(".",'');
            return newId;
        }
//        添加组件
        var n=1
        $('.component>div').on('click',function(){
            var ids=$(this).attr('id');
            if(ids){
                var thisType=ids.split('-')[1];
                console.log(thisType);
            }else{
                console.log('ids未定义');
            }
            var id=addId();
            console.log(id+'--->'+n);
            n++;
//            获取组件模板
            if(thisType=='map'){
                var mapId=addId();
                var mapArea='<div class="map" id="'+mapId+'"></div>'
                var edit='<div class="deledit"><span class="edit">编辑</span><span class="delete">删除</span></div>';
                $('#drag').append('<li data-type="map" class="item-list" id="'+id+'">'+mapArea+edit+'</li>');
                bbmap(mapId);
            }else{
                var a=$('.template .'+thisType).html();
                var edit='<div class="deledit"><span class="edit">编辑</span><span class="delete">删除</span></div>';
                $('#drag').append('<li class="item-list" data-type="'+thisType+'" id="'+id+'"><div class="'+thisType+'">'+a+edit+'</div></li>');
            }
            $('#'+id+' .delete').on('click',function(){
                if(confirm('点击确认将移除该组件,无法恢复')){
                    console.log(id);
                    $(this).parent().parent().remove();
                }
            });
        });
        function bbmap(id){
//                console.log(id);
//            setTimeout(function(){
//                //设置地图中心点。center除了可以为坐标点以外，还支持城市名
//                map.setCenter("成都");
//                //2秒后将视图切换到指定的缩放等级，中心点坐标不变
//                map.setZoom(10);
//            }, 2000);
                var map = new BMap.Map(id);
                var point = new BMap.Point(104.06792346,30.67994285);
                map.centerAndZoom(point, 18);
                var marker = new BMap.Marker(point);  // 创建标注
                map.addOverlay(marker);               // 将标注添加到地图中
        }
//        $('#dj-img').on('click',function(){
//            var id=addId();
//            console.log(id);
////            获取组件模板
//            var a=$('.lunbos').html();
//            $('#drag').append('<li id="'+id+'">'+a+'</li>');
//        });

        $('#drag').dragsort({
            dragSelector: "li",
            dragBetween: true,
            dragEnd: function(){
            },
            placeHolderTemplate: "<li><div class='placeHolder'>松开手放到此处</div></li>",
            scrollSpeed: 5
        });
        $(function() {
            $('.lunbo').unslider({
                speed: 500,               //  The speed to animate each slide (in milliseconds)
                delay: 5000,              //  The delay between slide animations (in milliseconds)
                complete: function() {},  //  A function that gets called after every slide animation
                keys: true,               //  Enable keyboard (left, right) arrow shortcuts
                dots: true,               //  Display dot navigation
                fluid: false              //  Support responsive design. May break non-responsive designs
            });
        });
        $('.btn-modular').click(function(){
            var tt=$(this).next('.dj-template').html();
            $('#drag').append('<li>'+tt+'</li>');
        });
        // 百度地图API功能


        function removeThis(){
            console.log($(this).val());
        }
        //        initSample();
    </script>
    <script>
        $('input[type="file"]').change(function(){
            console.log($('input[type="file"]').prop('files'));
        });
        //文字编辑功能
        (function(){
            $('.color').minicolors({
                animationSpeed: 50,
                animationEasing: 'swing',
                change: null,
                changeDelay: 0,
                control: 'hue',
                defaultValue: '',
                hide: null,
                hideSpeed: 100,
                inline: false,
                letterCase: 'lowercase',
                opacity: false,
                position: 'bottom left',
                show: null,
                showSpeed: 100,
                theme: 'bootstrap'
            });
            $(document).ready(function(){
                $('.wback').on('blur',function(){
                    $("#word1 .h3").css("background",$('.wback').val());
                    console.log($('.wback').val());
                });
                $('.wcolor').on('blur',function(){
                    $("#word1 .h3").css("color",$('.wcolor').val());
                    console.log($('.wcolor').val());
                });
                $('#title').on('keyup',function(){
                    $("#word1 .h3").text($(this).val());
                })
                CKEDITOR.replace( 'txtarea',{
                    toolbar :
                            [
                                ['FontSize','-','Bold', 'Italic','-', 'NumberedList', 'BulletedList', '-','Link', '-','JustifyLeft','JustifyCenter','JustifyRight']
                            ]
                });
                CKEDITOR.instances["txtarea"].on("instanceReady", function () {
                    this.document.on("keyup", function(){
                        validateText();
                    });
                });
            });
            function validateText(){
                var numText=CKEDITOR.instances.txtarea.getData();
                var numCounter=numText.length;
                $("#textcount").text(3000-numCounter);
                $("#word1 .content").html(numText);
            }
            $(document).ready(function(){
                validateText();
            });
        })();
    </script>

</body>
</html>